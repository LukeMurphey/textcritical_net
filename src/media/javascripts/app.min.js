var TextCritical={};define(["jquery","underscore","highcharts","libs/text!/media/templates/alert_message.html","libs/text!/media/templates/morphology_dialog.html","libs/text!/media/templates/work_info_dialog.html","libs/text!/media/templates/wiki_info_dialog.html","libs/text!/media/templates/loading_dialog.html","libs/text!/media/templates/search_results.html","libs/text!/media/templates/copy_dialog.html","libs/optional!facebook"],function(e,k,h,b,f,d,a,i,g,j){TextCritical.setFormatBreakLine=function(){e(".verse-container").addClass("block");e(".align-break").addClass("active")};TextCritical.unSetFormatBreakLine=function(){e(".verse-container").removeClass("block");e(".align-break").removeClass("active")};TextCritical.toggleTOC=function(){if(e(".table-of-contents").is(":visible")){e("#show-table-of-contents-phone").text("Show table of contents")}else{e("#show-table-of-contents-phone").text("Hide table of contents")}e(".table-of-contents").toggle("fast",function(){e(".division-filter").val("");e(".division-filter").change()})};TextCritical.toggleVerseBreak=function(){break_verses=!break_verses;if(break_verses){TextCritical.setFormatBreakLine()}else{TextCritical.unSetFormatBreakLine()}settings.set("break_verses",break_verses)};TextCritical.escapeIdentifier=function(l){return l.replace(".","\\.")};TextCritical.scrolltoAnchor=function(l){scrollTo=e("#"+l).offset();if(typeof scrollTo=="undefined"){console.warn("The id ("+l+") to scroll to is undefined")}else{e("html,body").animate({scrollTop:scrollTo.top},"slow")}};TextCritical.scrollToVerse=function(n,m){if(typeof m=="undefined"||m==null){console.warn("No base chapter URL was provided; will not be able to update the URL for the given verse");return true}var o="verse-"+n;var l=TextCritical.escapeIdentifier(o);title=document.title;history.pushState({verse:n},title,m+"/"+n+document.location.search);console.info("Updating the URL to point to the selected verse");e(".verse-container").removeClass("highlighted");e(".verse.number").removeClass("label-info");e("#"+l).addClass("highlighted");e("#"+l+" .label").addClass("label-info");TextCritical.scrolltoAnchor(l);return false};TextCritical.loadStoreSettings=function(){var l={break_verses:false};settings=new Store("settings");break_verses=settings.get("break_verses",l);if(break_verses){TextCritical.setFormatBreakLine()}};TextCritical.slugify=function(l){l=l.replace(/[^-a-zA-Z0-9,&\s]+/ig,"");l=l.replace(/-/gi,"_");l=l.replace(/\s/gi,"-");return l};TextCritical.go_to_chapter=function(l,m){document.location=TextCritical.resolve_path(m,l)};TextCritical.word_lookup=function(){var l=e(".work-data[data-work-title-slug]").data("work-title-slug");var m=e("#chapter-base-url").data();if(m&&m.chapterDescription){TextCritical.open_morphology_dialog(e(this).text(),l,m.chapterDescription)}else{TextCritical.open_morphology_dialog(e(this).text(),l)}return false};TextCritical.open_dialog=function(o,n,m){if(typeof m=="undefined"||m==null){m=""}e("#popup-dialog-content").html(n);var l='Look up at <a target="_blank" href="http://www.perseus.tufts.edu/hopper/morph?l=<%= word %>&la=greek">Perseus</a> or <a target="_blank" href="https://www.google.com/search?q=<%= word %>">Google</a>';e("#popup-dialog-extra-options").html(m);e("#popup-dialog-label").text(o);e("#popup-dialog").modal()};TextCritical.open_morphology_dialog=function(n,m,o){if(typeof o==="undefined"){var o=null}console.info("Obtaining the morphology of "+n);n=TextCritical.trim(n);e("#popup-dialog-content").html(k.template(i,{message:"Looking up morphology for "+k.escape(n)+"..."}));var l='Look up at <a target="_blank" href="http://www.perseus.tufts.edu/hopper/morph?l=<%= word %>&la=greek">Perseus</a> or <a target="_blank" href="https://www.google.com/search?q=<%= word %>">Google</a>';e("#popup-dialog-extra-options").html(k.template(l,{word:n}));e("#popup-dialog-label").text("Morphology: "+k.escape(n));e("#popup-dialog").modal();e.ajax({url:"/api/word_parse/"+n}).done(function(p){e("#popup-dialog-content").html(k.template(f,{parses:p,word:k.escape(n),work:m,division:k.escape(o)}));e("a.lemma").click(TextCritical.word_lookup);console.info("Successfully performed a request for the morphology of "+n)}).error(function(p,r,q){e("#popup-dialog-content").html("<h4>Parse failed</h4> The request to parse could not be completed");console.error("The request for the morphology failed for "+n)})};TextCritical.open_copy_dialog=function(l){l=TextCritical.trim(l);e("#popup-dialog-content").html(k.template(j,{text_to_copy:l}));e("#popup-dialog-extra-options").html("");e("#popup-dialog-label").text("Copy to clipboard");e("#popup-dialog").modal();setTimeout(function(){e(".clipboard-copy-text").focus();e(".clipboard-copy-text")[0].setSelectionRange(0,5000)},800);e(".clipboard-copy-text").on("click",function(){e(".clipboard-copy-text").focus();e(".clipboard-copy-text")[0].setSelectionRange(0,5000)})};TextCritical.get_work_info=function(l){var m="/api/work_info/"+l;var n=jQuery.Deferred();e.ajax({url:m}).done(function(o){o.work=l;o.success=true;console.info("Successfully performed a request for information on the work "+l);n.resolve(o)}).error(function(o,q,p){data={work:l,success:false};if(o.status===404){console.warn("No information could be obtained for the work "+l)}else{console.error("The request on the work failed for "+l)}n.reject(o,data)});return n};TextCritical.open_work_info_dialog=function(l,m){console.info("Obtaining information about "+l);search=TextCritical.trim(search);e("#popup-dialog-content").html(k.template(i,{message:"Looking up info for work "+k.escape(m)+"..."}));e("#popup-dialog-extra-options").html("");e("#popup-dialog-label").text(k.escape(m));e("#popup-dialog").modal();this.get_work_info(l).done(function(o){var n='<a target="_blank" class="external" href="<%= url %>">View on wikipedia</a>';e("#popup-dialog-extra-options").html(k.template(n,{url:o.wiki_info.url}));e("#popup-dialog-content").html(k.template(d,o))}).fail(function(n,o){if(n.status===404){e("#popup-dialog-content").html(k.template(d,o))}else{e("#popup-dialog-content").html("<h4>Request failed</h4> The request for information on this work could not be completed")}})};TextCritical.open_topic_dialog_for_element=function(){TextCritical.open_topic_dialog(this.dataset.querytitle,this.dataset.query,this.dataset.query2,this.dataset.query3)};TextCritical.open_topic_dialog=function(l,m,o,n){console.info("Obtaining information about "+l);m=TextCritical.trim(m);e("#popup-dialog-content").html(k.template(i,{message:"Looking up info for "+k.escape(l)+"..."}));e("#popup-dialog-extra-options").html("");e("#popup-dialog-label").text(k.escape(l));e("#popup-dialog").modal();this.get_wiki_info(l,m,o,n).done(function(q){var p='<a target="_blank" class="external" href="<%= url %>">View on wikipedia</a>';e("#popup-dialog-extra-options").html(k.template(p,{url:q.url}));e("#popup-dialog-content").html(k.template(a,q))}).fail(function(p,q){if(p.status===404){e("#popup-dialog-content").html(k.template(a,q))}else{e("#popup-dialog-content").html("<h4>Request failed</h4> The request for information could not be completed")}})};TextCritical.get_wiki_info=function(m,n,p,o){if(typeof n==="undefined"){var n=m}if(typeof p==="undefined"){var p=null}if(typeof o==="undefined"){var o=null}var l="/api/wikipedia_info/"+n;if(p!==null&&o!==null){l="/api/wikipedia_info/"+n+"/"+p+"/"+o}else{if(p!==null){l="/api/wikipedia_info/"+n+"/"+p}else{if(o!==null){l="/api/wikipedia_info/"+n+"/"+o}}}var q=jQuery.Deferred();e.ajax({url:l}).done(function(r){r.topic=m;r.success=true;console.info("Successfully performed a request for information on "+m);q.resolve(r)}).error(function(r,t,s){data={topic:m,success:false};if(r.status===404){console.warn("No information could be obtained for "+m)}else{console.error("The request on the topic failed for "+m)}q.reject(r,data)});return q};TextCritical.trim=function(l){return String(l).replace(/^\s+|\s+$/g,"")};TextCritical.shorten=function(o,r,l,p){if(typeof p=="undefined"||p==null){var p="&hellip;"}if(typeof l=="undefined"||l==null){var l=true}var q=o.length>r,m=q?o.substr(0,r-1):o;m=l&&q?m.substr(0,m.lastIndexOf(" ")):m;return q?m+p:m};TextCritical.highlight_selected_word=function(){TextCritical.highlight_word(e(this).text())};TextCritical.unhighlight_all_words=function(l){if(typeof l=="undefined"){var l="highlighted"}e(".word").removeClass(l)};TextCritical.normalize=function(l){if(l.hasOwnProperty("normalize")){return l.normalize()}else{return l}};TextCritical.highlight_word=function(p,o,l){if(typeof o=="undefined"){var o="highlighted"}if(typeof l=="undefined"){var l=true}if(l){TextCritical.unhighlight_all_words(o)}var n=TextCritical.escape_regex(TextCritical.normalize(p));var m=new RegExp("^"+n+"$","i");console.info("Highlighting "+p);e(".word").filter(function(){return m.test(TextCritical.normalize(e(this).text()))}).addClass(o)};TextCritical.contains_search_words=function(l){var m=l.match(/([_0-9a-z]+[:][-_0-9a-z]+)|([\w_]+[:]["][-\w ]*["])|([^ :]+)/gi);for(c=0;c<m.length;c++){if(m[c].search(":")<0){return true}}return false};TextCritical.set_caret_at_end=function(n){var m=n.value.length;if(document.selection){n.focus();var l=document.selection.createRange();l.moveStart("character",-m);l.moveStart("character",m);l.moveEnd("character",0);l.select()}else{if(n.selectionStart||n.selectionStart=="0"){n.selectionStart=m;n.selectionEnd=m;n.focus()}}};TextCritical.set_search_url=function(o,n,m,q){if(typeof m==="undefined"){var m=false}if(typeof q==="undefined"){var q=false}var p={};if(related_forms){p.include_related=1}if(q){p.ignore_diacritics=1}if(n<=1||parseInt(n)<=1){p.q=o;n=1}else{p.q=o;p.page=n}var l=document.location.pathname+"?"+e.param(p);history.pushState({query:o,page:n,include_related_forms:m,ignore_diacritics:q},document.title,l)};TextCritical.make_bar_chart=function(p,r,o,l){if(typeof l==="undefined"){l="No data matched"}var m=[];var q=[];if(o){for(var n in o){if(o.hasOwnProperty(n)){m.push(n);q.push(o[n])}}}if(q.length===0){p.html('<div class="alert alert-info alert-block">'+l+"</div>");return false}p.highcharts({colors:["#006dcc"],chart:{type:"bar",backgroundColor:"#2f2f2f",width:e(".tab-pane.active").width()},title:{text:r,style:{color:"#DDD"}},legend:{enabled:false},xAxis:{categories:m,title:{text:null},labels:{style:{color:"#DDD"}},lineColor:"#DDD",tickColor:"#DDD"},yAxis:{min:0,title:{text:"Count",align:"high"},labels:{overflow:"justify",style:{color:"#DDD"}}},plotOptions:{bar:{dataLabels:{enabled:false}}},credits:{enabled:false},series:[{name:"Count",data:q}]})},TextCritical.do_search=function(m,l){var n=e("#search-term").val();if(typeof m=="undefined"||m==null){if(e("#page-number").val().length>0){m=parseInt(e("#page-number").val());console.info("Getting page from #page-number:"+e("#page-number").val())}else{m=1;console.info("Setting page to 1")}}else{console.info("Using provided page: "+m)}related_forms=e("#related_forms:checked").length;ignore_diacritics=e("#ignore_diacritics:checked").length;if(typeof l=="undefined"){l=true}if(typeof related_forms=="undefined"){related_forms=0}else{if(!related_forms){related_forms=0}else{related_forms=1}}if(typeof ignore_diacritics=="undefined"){ignore_diacritics=0}else{if(!ignore_diacritics){ignore_diacritics=0}else{ignore_diacritics=1}}if(m<=0){console.warn("Page number is invalid (must be greater than zero)");m=1}e("#search-results-content").attr("data-page-number",m);e("#searching").show();e("#search-results-content").block({message:null,overlayCSS:{backgroundColor:"#2f2f2f",opacity:0.8}});console.info("Executing search on page "+m+" for "+n);e.ajax({url:"/api/search/"+encodeURIComponent(n)+"?page="+m+"&related_forms="+related_forms+"&ignore_diacritics="+ignore_diacritics}).done(function(o){e("#search-results-content").html(k.template(g,{word:k.escape(n),search_results:o}));if(o.result_count>(o.page*o.page_len)){e(".next-page-link").click(TextCritical.do_search_next)}if(o.page>1){e(".previous-page-link").click(TextCritical.do_search_previous)}e("#search-results-content").unblock();console.info("Successfully searched for "+n);TextCritical.make_bar_chart(e("#chart-word-frequency"),"Frequency of matched words",o.matched_terms,"No data available on matched terms");TextCritical.make_bar_chart(e("#chart-work-frequency"),"Number of matched verses by work",o.matched_works,"No data available on matched works");TextCritical.make_bar_chart(e("#chart-section-frequency"),"Number of matched verses by section",o.matched_sections,"No data available on matched sections");e("#searching").hide();e("#search-results-content").show();if(l){TextCritical.set_search_url(n,m,related_forms,ignore_diacritics)}}).error(function(o,q,p){e("#search-results-content").html("<h4>Search failed</h4> The search request could not be completed");console.error("The request to search failed for "+n);e("#searching").hide();e("#search-results-content").show()});return false};TextCritical.do_fresh_search=function(){return TextCritical.do_search(1)};TextCritical.do_search_next=function(){return TextCritical.change_page(1)};TextCritical.change_page=function(m){var l=parseInt(e("#search-results-content").attr("data-page-number"));if(typeof l=="undefined"){l=1}else{if(isNaN(l)){console.warn("Page number is invalid");l=1}else{l=l+m}}TextCritical.do_search(l)};TextCritical.search_this_work=function(){var l=e(".work-data[data-work-title-slug]").data("work-title-slug");var n="/search?q=work:"+l;var m=e("#chapter-base-url").data();if(m){n+=' section:"'+m.chapterDescription+'"'}document.location=n;return false};TextCritical.do_search_previous=function(){return TextCritical.change_page(-1)};TextCritical.search_page_popstate=function(l){if(l.state==null){return}e("#search-term").val(l.state.query);TextCritical.do_search(l.state.page,false)};TextCritical.convert_search_query_beta_code=function(){var l=e("#search-term").val();e.ajax({url:"/api/convert_query_beta_code/?q="+l}).done(function(m){e("#search-term").val(m)})};TextCritical.add_word_morphology_links=function(l,o){if(typeof o==="undefined"){var o=l.text()}var n=o.split(" ");l.text("");for(var m=0;m<n.length;m++){l.append('<span class="word">'+n[m]+" </span>")}};TextCritical.get_related_forms=function(){query=encodeURIComponent(e("#text").val());e.ajax({url:"/api/word_forms/"+query}).done(function(l){e("#output").text(l.forms.join(", ").toLowerCase())})};TextCritical.flatten_typeahead_hints=function(m){hints_flattened=[];for(var l=0;l<m.length;l++){if(k.indexOf(hints_flattened,m[l].desc)<0){hints_flattened.push(m[l].desc)}}return hints_flattened};TextCritical.works_search_typeahead_hints=[];TextCritical.works_search_typeahead_hints_flattened=[];TextCritical.get_works_search_typeahead_hints=function(l){var n=jQuery.Deferred();if(typeof l=="undefined"){var l=true}if(TextCritical.works_search_typeahead_hints_flattened.length>0){console.info("Type-ahead hints already available via the cache");if(l){n.resolve(TextCritical.works_search_typeahead_hints_flattened)}else{n.resolve(TextCritical.works_search_typeahead_hints)}}else{console.info("Retrieving list of typeahead hints from the server");var n=jQuery.Deferred();var m=e.ajax({url:"/api/works_typeahead_hints",success:function(o){TextCritical.works_search_typeahead_hints=o;TextCritical.works_search_typeahead_hints_flattened=TextCritical.flatten_typeahead_hints(TextCritical.works_search_typeahead_hints);if(l){n.resolve(TextCritical.works_search_typeahead_hints_flattened)}else{n.resolve(TextCritical.works_search_typeahead_hints)}},type:"GET"})}return n};TextCritical.jump_to_searched_text=function(l){list=TextCritical.works_search_typeahead_hints;found=0;url=null;for(var m=0;m<list.length;m++){if(list[m].desc==l){found=found+1;url=list[m].url}}if(found>1||found==0||url==null||url==""){return false}else{location=url;return true}};TextCritical.show_alert=function(o,n,p,m){if(typeof p=="undefined"||p==null){p="info"}if(typeof m=="undefined"){m=null}e("#messages").append(k.template(b,{title:k.escape(o),message:k.escape(n),level:p}));var l=e("#messages  > .alert:last-child");if(m!==null&&m>0){setTimeout(function(){l.animate({height:"0px","margin-top":"0px","margin-bottom":"0px","padding-top":"0px","padding-bottom":"0px"},250,function(){l.remove()})},m)}};TextCritical.show_small_alert=function(l){e("#small-message  > .message-text").html(l);e("#small-message").show();setTimeout(function(){e("#small-message").slideUp(100)},2500)};TextCritical.update_work_url=function(l){if(location.pathname!==l){console.info("Updating the URL to reflect the canonical URL");title=document.title;history.replaceState({},title,l);TextCritical.show_alert("Stale URL","The URL you were using was old so redirected to the new one. You may want to update your shortcuts.","info")}};TextCritical.make_shareable_url=function(){if(location.pathname.indexOf("/work/")==0){return location.protocol+"//"+location.host+location.pathname}else{return TextCritical.trimTrailingPound(location.href)}};TextCritical.get_note_content=function(n,m,l){if(typeof m==undefined||m==null){var m=false}if(m>0){content=TextCritical.shorten(e("#content_for_"+n).text(),m,true,l)}else{content=e("#content_for_"+n).html()}return content};TextCritical.get_note_title=function(l){note_number=e("#"+l).attr("data-note-number");if(note_number!=null){return"Note "+note_number}else{return"Note"}};TextCritical.open_note_dialog=function(l){title=TextCritical.get_note_title(e(this).attr("id"));content=TextCritical.get_note_content(e(this).attr("id"));TextCritical.open_dialog(title,content);return false};TextCritical.escape_regex=function(l){return l.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};TextCritical.highlight_searched_terms=function(){var l=TextCritical.get_parameter_by_name(document.location.search,"highlight",true);if(l!==undefined){for(var m=0;m<l.length;m++){TextCritical.highlight_word(decodeURIComponent(l[m]),"searched",false)}}};TextCritical.get_parameter_by_name=function(n,m,q){if(typeof q=="undefined"){var q=false}m=m.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var p=new RegExp("[\\?&]"+m+"(=([^&#]*))?","g");var o;var l=[];while(o=p.exec(n)){if(o[2]!==undefined){l.push(o[2].replace(/\+/g," "))}else{l.push("")}if(!q){return l[0]}}if(l.length==0){return undefined}else{return l}};TextCritical.add_async_parameter=function(l){if(TextCritical.get_parameter_by_name(l,"async")!==undefined){}else{if(l.indexOf("?")>0){l=l+"&async"}else{l=l+"?async"}}return l};TextCritical.load_ajah=function(l){l=TextCritical.add_async_parameter(l);e.ajax({url:l,success:function(m){console.info("Loading page content with asynchronous request");e("#main-content").html(m).fadeIn("slow");e("#async-loading-message").hide();console.info("Sucessfully loaded page content with asynchronous request")},error:function(m,o,n){console.error("Failed to load the page content with asynchronous request");e("#main-content").html("<h3>Yikes! That didn't work</h3>I'm sorry, but the content couldn't be loaded").fadeIn("slow");e("#async-loading-message").hide()}})};TextCritical.pre_load_next_link=function(){next_href=e("link[rel=next]").attr("href");if(next_href!==undefined){next_href=TextCritical.add_async_parameter(next_href);console.info("Beginning request to cache content of the next chapter ("+next_href+")");e.ajax({url:next_href}).done(function(l){console.info("Successfully cached the contents of the next chapter at "+next_href)}).error(function(l,n,m){console.error("Request for next chapter's content failed (url attempted was "+next_href+")")})}};TextCritical.convert_search_query_beta_code=function(l){converted_beta_code=null;e.ajax({async:false,url:"/api/beta_code_to_unicode/?text="+l}).done(function(m){converted_beta_code=m.unicode});return converted_beta_code};TextCritical.freeze_height=function(l){e(l).css("height",e(l).height())};TextCritical.unfreeze_height=function(l){e(l).css("height","auto")};TextCritical.data_attribute_contains=function(l,n){for(var m=0;m<l.length;m++){attribute=l[m];if(attribute.name.indexOf("data-")==0){if(attribute.value.toLowerCase().indexOf(n)>=0){return true}}}return false};TextCritical.list_filter=function(l,n,m){if(typeof m=="undefined"){var m=false}e(l).change(function(){var o=e(this).val().toLowerCase();if(o){if(m){TextCritical.freeze_height(n)}e(n).find("a").each(function(p){if(e(this).text().toLowerCase().indexOf(o)>=0){e(this).parent().show()}else{if(TextCritical.data_attribute_contains(this.attributes,o)){e(this).parent().show()}else{e(this).parent().hide()}}})}else{e(n).find("li").show();if(m){TextCritical.unfreeze_height(n)}}return false}).keyup(function(){e(this).change()})};TextCritical.resolve_path=function(o,l){var m=null;var n=e.ajax({url:"/api/resolve_reference/?work="+o+"&ref="+l,async:false,success:function(p){m=p.url},type:"GET"});return m};TextCritical.facebookInit=function(){if(typeof FB!=="undefined"){FB.init({appId:"226685657481279",xfbml:true})}};TextCritical.getTextToShare=function(m,l){if(typeof m==="undefined"||m==null){var m=""}if(TextCritical.trim(m).length==0||l===true){if(window.getSelection().toString().length>0){m=window.getSelection().toString()}else{if(e(".verse-container.highlighted .verse:not(.label)").length>0){m=e(".verse-container.highlighted .verse:not(.label)").text()}else{if(e(".verse-container").length>0){m=e(".verse-container").clone().children().remove().end().text()}}}}m=TextCritical.trim(m);m=m.replace(/[ ]*(\n|\t)[ ]*/g," ");m=m.replace(/ [ ]+/gi," ");return m};TextCritical.trimTrailingPound=function(l){if(l.slice(-1)=="#"){return l.slice(0,l.length-1)}else{return l}};TextCritical.postToFacebook=function(l,p,n,o,m){if(typeof o==="undefined"||o==null){var o=TextCritical.make_shareable_url()}else{o=TextCritical.trimTrailingPound(o)}if(typeof m==="undefined"||m==null){var m=document.title}p=TextCritical.getTextToShare(p,n);FB.ui({method:"feed",link:o,name:m,caption:l,description:TextCritical.shorten(p,400,true,"...")},function(q){})};TextCritical.makeTweetURL=function(m,n,l){if(typeof m==="undefined"||m==null){var m=location.href}n=TextCritical.getTextToShare(n,l);twitterLink="https://twitter.com/share";data={url:TextCritical.trimTrailingPound(m),text:TextCritical.shorten(n,140-m.length,true,"...")};return twitterLink+"?"+e.param(data)};TextCritical.postToTwitter=function(n,l,m){twitterLink=TextCritical.makeTweetURL(m,n,l);window.open(twitterLink,"_blank")};TextCritical.serialize=function(m){var n=[];for(var l in m){n.push(encodeURIComponent(l)+"="+encodeURIComponent(m[l]))}return n.join("&")};TextCritical.sendAnEmail=function(n,l,m,o){if(typeof o==="undefined"||o==null){o=location.href}if(n===undefined||o==null){n=document.title}l=TextCritical.getTextToShare(l,m);data={subject:n,body:TextCritical.shorten(l,1000,true,"...")+"\n\n[Source: "+TextCritical.trimTrailingPound(o)+"]",};document.location.href="mailto:?"+TextCritical.serialize(data)};TextCritical.pollForShareButtons=function(){if(e("iframe",".sharing-buttons").length<2){setTimeout(TextCritical.pollForShareButtons,200)}else{setTimeout(function(){e(".sharing-buttons").fadeIn(400,function(){e(".sharing-buttons").removeClass("hide").css("display","")})},1500)}};e("body").delegate(".wiki-info","click",function(){TextCritical.open_topic_dialog(this.dataset.querytitle,this.dataset.query,this.dataset.query2,this.dataset.query3);return false});e("body").delegate(".open-work-info","click",function(){TextCritical.open_work_info_dialog(this.dataset.workTitleSlug,this.dataset.workTitle);return false})});