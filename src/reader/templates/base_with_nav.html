{% extends "base.html" %}
{% block base_content %}
    <div id="fb-root"></div>
    <div class="navbar navbar-static-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" title="TextCritical.net homepage" href="{% url "home" %}">TextCritical.net</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a class="librarydialog" href="{% url "works_index" %}">Library</a></li>
              <li><a href="{% url "search" %}">Search</a></li>
              <li><a class="aboutdialog" hrefw="{% url "about" %}">About</a></li>
						</ul>
						<form class="navbar-search pull-right" id="search" action="{% url "works_index" %}" method="get">
							<input autocorrect="off" autocomplete="off" data-provide="typeahead" type="text" name="search" class="squared-search-query works-search-query" placeholder="Search Library" value="{{filter|default_if_none:""}}">
						</form>
          </div><!--/.nav-collapse -->
          <div class="print-url pull-right visible-print">https://textcritical.net{{ request.get_full_path }}</div>
        </div>
      </div>
    </div>
	
    <div class="container">
	  <div id="messages">
	  	{% for warning in warnings %}
	    <div class="alert">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<strong>{{warning.0}}:</strong>
			{{warning.1}}
			</div>
	    {% endfor %}
		</div>
		<workindexdialog readworkurl="/work" searchurl="{% url "search" %}" hidewhenopen=".main-content-holder"></workindexdialog>
		<aboutdialog></aboutdialog>
    {% block content %}{% endblock %}

{% endblock %}
{% block javascript_base %}
    <script language="javascript">
    require(["jquery", "riot_require", "bootstrap", "app", "datatables", "libs/optional!facebook"], function($, riot) {
    	$(document).ready( function() {
    		
    		// Configure the typeahead    		
    		$.when(TextCritical.get_works_search_typeahead_hints()).done(function(hints){
    			$(".works-search-query").typeahead({
    				source: hints
    			});
    		});
    		
			$('#search').submit(function() {
				console.info("Searching for the searched text");
				return !TextCritical.jump_to_searched_text( $('#search > .works-search-query').val() );
			});

			// Make an object for the nav observables to be attached to
			function Nav() {
				riot.observable(this);
			}

			var nav = new Nav()

			{% if request.resolver_match.view_name != 'works_index' and request.resolver_match.view_name != 'home' %}
			// Mount the work index dialog tag
			var tag = riot.mount('workindexdialog', {
				observable: nav
			});

			// Wire up the show library to the library link
			$('.librarydialog').click(function(e){
				nav.trigger('open-library-modal');
				e.preventDefault();
				return false;
			}.bind(this));
			{% endif %}

			// Mount the about dialog
			riot.mount('aboutdialog', {
				observable: nav,
				version_info: '{% include "VERSION.txt" %}'
			});

			// Wire up the about dialog to the about link
			$('.aboutdialog').click(function(e){
				nav.trigger('open-about-modal');
				e.preventDefault();
				return false;
			}.bind(this));
    		
			window.fbAsyncInit = TextCritical.facebookInit();
			{% if INCLUDE_SHARING_BUTTONS %}
			TextCritical.pollForShareButtons();
    	{% endif %}
    	});
    });
    </script>

{% endblock %}