{% extends "base_with_nav.html" %}
{% block content %}
    <div class="container">
        
           {% for warning in warnings %}
           <div class="alert alert-block">
		    <button type="button" class="close" data-dismiss="alert">x</button>
		    <h4>Warning!</h4>
		    {{warning}}
		   </div>
           {% endfor %}
    
        <ul class="breadcrumb">
            <li><a href="{% url home %}">Home</a> <span class="divider">/</span></li>
            <li><a href="{% url works_index %}">Library</a> <span class="divider">/</span></li>
            <li class="active">{{work.title}}:{{chapter}}</li>
        </ul>
        
        <h1>{{work.title}} {% if chapters|length > 1 %}{{chapter}}{% endif %} <small>By {{work.authors.all|join:", "}}</small></h1>
        
        {% comment %}
        ##############################
        # Button toolbar
        ##############################
        {% endcomment %}
        <div class="btn-toolbar">
            <div class="btn-group">
            
                {% comment %}
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                    Table of Contents
                    <span class="caret"></span>
                </a>
                
		            <ul class="dropdown-menu">		                  
		                {% for division_part in divisions.all %}
		                   {% if chapter.parent_division.id == division_part.id %}
		                <li class="division_{{division_part.level}} active">
		                    <a href="{% url read_work work.title_slug division_part.sequence_number %}"><i class="icon-book icon-white"></i>{{division_part}}</a>
		                </li>
		                   {% else %}
		                <li class="division_{{division_part.level}}">
		                    <a href="{% url read_work work.title_slug division_part.sequence_number %}"><i class="icon-book"></i>{{division_part}}</a>
		                </li>
		                   {% endif %}
		                {% endfor %}
                    </ul>
                {% endcomment %}
                
                <button class="btn {% if not divisions %}disabled{% endif %}" data-toggle="button" id="show_table_of_contents">Table of Contents</button>
                <button id="align_break" class="btn"><i class="icon-align-left"></i></button>
            </div>
            {% comment %}
            <div class="btn-group">
                <button class="btn">Side-by-side</button>
                <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                <ul class="dropdown-menu">
                    <li><a href="#">English (Bill Neise)</a></li>
                </ul>
            </div>
            {% endcomment %}
        </div>
        
        {% comment %}
        ##############################
        # Table of contents
        ##############################
        {% endcomment %}
        {% load reader_extras %}
        {% if divisions %}
        <div class="table_of_contents ">
            {% comment %}<h2><small>Table of Contents</small></h2>{% endcomment %}
	        <ul class="nav nav-list">
	            {% comment %}<li class="nav-header">Table of Contents</li>{% endcomment %}
	            {% for division_part in divisions.all %}
	               {% if chapter.parent_division.id == division_part.id %}
	            <li class="division_{{division_part.level}} active">
	                <a href="{% url read_work work.title_slug division_part.descriptor %}"><i class="icon-book icon-white"></i>{{division_part}}</a>
	            </li>
	               {% else %}
                <li class="division_{{division_part.level}}">
                    <a href="{% url read_work work.title_slug division_part.descriptor %}"><i class="icon-book"></i>{{division_part}}</a>
                </li>
	               {% endif %}
	            {% endfor %}
	        </ul>
        </div>
        {% endif %}
        
        {% comment %}
        ##############################
        # Chapter progress indicator
        ##############################
        {% endcomment %}
        {% if chapters|length > 1 %}
        {% load humanize %}
        {{completed_chapters|ordinal}} of {{total_chapters}} chapters ({{progress|floatformat:"0"}}%)
        <div class="reading progress progress-striped">
            <div class="bar" style="width: {{progress}}%;"></div>
        </div>
        {% endif %}
        
        {% comment %}
        #############################
        # Chapter division indicator
        ##############################
        {% endcomment %}
        {% if chapter.parent_division %}
        <h2>{{chapter.parent_division}}</h2>
        {% endif %}
        
        {% for verse in verses.all %}
        <span id="verse_{{verse.indicator}}" class="verse_container {% if verse.indicator == verse_to_highlight %}highlighted{% endif %}">
            {% if verse.indicator|length > 0 %}
            <a class="verse_link" data-verse="{{verse.indicator}}" id="verse_link_{{verse.indicator}}" href="?verse={{verse.indicator}}"><span class="label {% if verse.indicator == verse_to_highlight %}label-info{% endif %} verse number">{{verse.indicator}}</span></a>
	        {% endif %}
	        {{verse.original_content|xml_to_html5:chapter.work.language|safe}}
        </span>
        {% endfor %}        
        
         
        {% comment %}
        #############################
        # Pagination
        #############################
        {% endcomment %}
        
        {% if chapters|length > 1 %}
        <div class="pagination">
        	<ul>
        {% if previous_chapter %}
	            <li class="previous">
                {% if previous_chapter.parent_division__descriptor %}
                    <a href="{% url read_work work.title_slug previous_chapter.parent_division__descriptor previous_chapter.descriptor %}">&larr; Previous</a>
                {% else %}
                    <a href="{% url read_work work.title_slug previous_chapter.descriptor %}">&larr; Previous</a>
                {% endif %}
	            </li>
        {% endif %}
        {% for c in chapters %}
        		{% if c == chapter %}
        		<li class="active" >
        		{% else %}
        		<li>
        		{% endif %}
        		{% if chapter.parent_division %}
                   <a href="{% url read_work work.title_slug chapter.parent_division.descriptor c.descriptor %}">{{c}}</a>
        		{% else %}
                   <a href="{% url read_work work.title_slug c.descriptor %}">{{c}}</a>
        		{% endif %}
        		</li>
        {% endfor %}
        {% if next_chapter %}
	            <li class="next">
	            {% if next_chapter.parent_division__descriptor %}
	                <a href="{% url read_work work.title_slug next_chapter.parent_division__descriptor next_chapter.descriptor %}">Next &rarr;</a>
	            {% else %}
	                <a href="{% url read_work work.title_slug next_chapter.descriptor %}">Next &rarr;</a>
	            {% endif %}
	            </li>
        {% endif %}
        	</ul>
        </div>
        {% endif %}
    </div>

{% endblock %}

{% block javascript %}
<script language="javascript">

require(["jquery", "store", "app"], function($) {
    loadStoreSettings();
    $('#align_break').click(toggleVerseBreak);
    $('#show_table_of_contents').click( toggleTOC );
    
    $(".verse_link").click(function() {
    	return scrollToVerse( $(this).attr("data-verse") );
    });
    
    {% if verse_to_highlight %}
    scrolltoAnchor("verse_{{verse_to_highlight}}");
    {% endif %}
});
</script>
{% endblock %}