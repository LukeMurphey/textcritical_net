var TextCritical={};TextCritical.setFormatBreakLine=function(){$(".verse_container").addClass("block");$("#align_break").addClass("active")};TextCritical.unSetFormatBreakLine=function(){$(".verse_container").removeClass("block");$("#align_break").removeClass("active")};TextCritical.toggleTOC=function(){$(".table_of_contents").toggle("fast","swing")};TextCritical.toggleVerseBreak=function(){break_verses=!break_verses;if(break_verses){TextCritical.setFormatBreakLine()}else{TextCritical.unSetFormatBreakLine()}settings.set("break_verses",break_verses)};TextCritical.scrolltoAnchor=function(a){$("html,body").animate({scrollTop:$("#"+a).offset().top},"slow")};TextCritical.scrollToVerse=function(b,a){if(a==null||a==undefined){console.warn("No base chapter URL was provided; will not be able to update the URL for the given verse");return true}var d="verse_"+b;title=document.title;history.pushState({verse:b},title,a+"/"+b);console.info("Updating the URL to point to the selected verse");$(".verse_container").removeClass("highlighted");$(".verse.number").removeClass("label-info");$("#"+d).addClass("highlighted");$("#"+d+" .label").addClass("label-info");TextCritical.scrolltoAnchor(d);return false};TextCritical.loadStoreSettings=function(){var a={break_verses:false};settings=new Store("settings");break_verses=settings.get("break_verses",a);if(break_verses){TextCritical.setFormatBreakLine()}};TextCritical.slugify=function(a){a=a.replace(/[^-a-zA-Z0-9,&\s]+/ig,"");a=a.replace(/-/gi,"_");a=a.replace(/\s/gi,"-");return a};TextCritical.resolve_path=function(b,d){b=TextCritical.trim(b).toLowerCase();for(c=0;c<d.length;c++){d[c]=d[c].toLowerCase()}var e=window.location.pathname.split("/");var f=[];for(i=0;i<e.length;i++){if(e[i].length>0){f.push(e[i])}if(f.length>=2){break}}divisions_map={};for(c=0;c<d.length;c++){divisions_map[d[c]]=TextCritical.slugify(d[c]);b=b.replace(d[c],TextCritical.slugify(d[c]))}refs=b.split(/[ :._]+/);for(var a in divisions_map){for(c=0;c<refs.length;c++){refs[c]=refs[c].replace(divisions_map[a],a)}}return"/"+f.concat(refs).join("/")};TextCritical.go_to_chapter=function(a,b){document.location=TextCritical.resolve_path(a,b)};TextCritical.word_lookup=function(){TextCritical.open_morphology_dialog($(this).text());return false};TextCritical.open_morphology_dialog=function(d){console.info("Obtaining the morphology of "+d);d=TextCritical.trim(d);var b=$("#morphology-loading").html();$("#morphology-dialog-content").html(_.template(b,{message:"Looking up morphology for "+_.escape(d)+"..."}));var a='Look up at <a target="_blank" href="http://www.perseus.tufts.edu/hopper/morph?l=<%= word %>&la=greek">Perseus</a> or <a target="_blank" href="https://www.google.com/search?q=<%= word %>">Google</a>';$("#morphology-dialog-extra-options").html(_.template(a,{word:d}));$("#morphology-dialog-label").text("Morphology: "+_.escape(d));$("#morphology-dialog").modal();$.ajax({url:"/api/word_parse/"+d}).done(function(f){var e=$("#morphology-info").html();$("#morphology-dialog-content").html(_.template(e,{parses:f,word:_.escape(d)}));$("a.lemma").click(TextCritical.word_lookup);console.info("Successfully performed a request for the morphology of "+d)}).error(function(e,g,f){$("#morphology-dialog-content").html("<h4>Parse failed</h4> The request to parse could not be completed");console.error("The request for the morphology failed for "+d)})};TextCritical.trim=function(a){return String(a).replace(/^\s+|\s+$/g,"")};TextCritical.highlight_selected_word=function(){TextCritical.highlight_word($(this).text())};TextCritical.unhighlight_all_words=function(){$(".word").removeClass("highlighted")};TextCritical.highlight_word=function(b){TextCritical.unhighlight_all_words();var a=new RegExp("^"+b+"$");console.info("Highlighting "+b);$(".word").filter(function(){return a.test($(this).text())}).addClass("highlighted")};