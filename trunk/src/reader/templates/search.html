{% extends "base_with_nav.html" %}
{% block content %}
{% load string_utils %}

<script type="text/html" id='search-results'>

	<% if( search_results.results.length == 0){ %>
<div class="alert alert-block">
  No results were found matching the provided search
</div>
	<% } %>
	<% for (var i = 0; i < search_results.results.length; i++) { %>
		<% var search_result = search_results.results[i]; %>
		<div class="work-description">
			<a href="<%= search_result["url"] %>"><%= search_result["work"] %>, <%= search_result["description"] %></a>
		</div>
		<div class="highlights">
			<% if( search_result["highlights"].length > 0 ){ %>
			<%= search_result["highlights"] %>
			<% } else { %>
			<%= search_result["content_snippet"] %>
			<% } %>
		</div>
	<% } %>

<% 
if( search_results.result_count > ( search_results.page * search_results.page_len ) ) {
	has_next = true;
}
else{
	has_next = false;
}

if( search_results.page <= 1 ){
	has_previous = false;
}
else{
	has_previous = true;
}
%>

<div class="search-results-page-info">Page <%= search_results.page %> of <%= Math.ceil(search_results.result_count / search_results.page_len) %></div>

<ul class="pager">
	<li class="previous <% if( has_previous == false ) { %>disabled<% } %>">
		<a href="#" class="previous-page-link">&larr; Previous</a>
	</li>
	<li class="next <% if( has_next == false ) { %>disabled<% } %>">
		<a href="#" class="next-page-link">Next &rarr;</a>
	</li>
</ul>
</script>


<form id="search-form">
	<legend>Search</legend>
	<div class="input-append">
	 	<input class="span10" id="search-term" placeholder="Enter the text to search for" type="text" value="{{query|addspaceifnotempty|default_if_none:""}}"/>
	 	<input type="hidden" id="page-number" name="page" value="{{page|default_if_none:""}}" />
	 	<button id="search-button" class="btn btn-primary" type="button" >Submit Search</button>
	</div>
</form>

<div id="searching" class="searching-animation">Searching ...</div>
<div class="search-results" id="search-results-content"></div>
		

		
{% endblock %}

{% block javascript %}
<script language="javascript">

require(["jquery", "store", "app", "underscore", "blockui"], function($) {
	
	$(document).ready(function() {
		
		// Execute the search if we already got a search term
		if ( $("#search-term").val().length > 0 && TextCritical.contains_search_words($("#search-term").val()) ){
			TextCritical.do_search();
		}
		
		TextCritical.set_caret_at_end( $("#search-term")[0] );
		
		$("#search-button").click( TextCritical.do_fresh_search );
		$("#search-form").submit( TextCritical.do_fresh_search );
		
		$(".next-page-link").click( TextCritical.do_search_next );
		$(".previous-page-link").click( TextCritical.do_search_previous );
	});

});
</script>
{% endblock %}