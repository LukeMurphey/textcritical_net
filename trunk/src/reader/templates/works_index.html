{% extends "base_with_nav.html" %}
{% block style %}
  <link rel="stylesheet" href="{{ MEDIA_URL }}/stylesheets/jquery_ui_bootstrap/jquery-ui-1.8.16.custom.css">
{% endblock %}

{% block content %}
        <ul class="breadcrumb">
            <li><a href="{% url home %}">Home</a> <span class="divider">/</span></li>
            <li class="active">Library</li>
        </ul>

        <h1>Library</h1>
        
        <div id="loading" class="loading_animation">Loading ...</div>
        
        <table class="table table-striped table-hover" id="works_list" >
		    <thead>
		        <th>Title</th>
		        <th>Author</th>
		        <th class="hidden-phone">Editor</th>
		        <th></th>
		    </thead>
		    <tbody>
		    {% for work in works %}
			    <tr>
			        <td><i class="icon-book {% if USE_DARK_THEME|default:0 %}icon-white{% endif %}"></i> <a href="{% url read_work work.title_slug %}">{{work.title}}</a></td>
			        <td>{{work.authors.all|join:", "}}</td>
			        <td class="hidden-phone">{{work.editors.all|join:", "}}</td>
			        <td><a href="{% url search %}?q=work_id:{{work.title_slug}}">Search this work</a></td>
			    </tr>
		    {% endfor %}
		    </tbody>
		</table>
		
{% endblock %}

{% block javascript %}
<script language="javascript">
require(["jquery", "datatables"], function($) {
	
	function updateFilter(){
		textcritical.datatable.fnFilter( $('input.search-query').val() );
	}
	
	function updateMainFilter(){
		$('input.search-query').val( $('input[aria-controls="works_list"]').val() );
	}
	
    $(document).ready(function() {
    	textcritical.datatable = $('#works_list').dataTable( {
						            "bPaginate": true,
						            "bLengthChange": false,
						            "bJQueryUI": false,
						            "bFilter": true,
						            "bSort": true,
						            "bInfo": true,
						            "bAutoWidth": false
        } );
        
        {% if filter %}textcritical.datatable.fnFilter( "{{filter|escapejs}}" );{% endif %}
        $('input.search-query').keyup(updateFilter);
        $('#search').submit( function() { return false; });
        
        $('input[aria-controls="works_list"]').keyup(updateMainFilter);
        
        $('#loading').hide();
        $('#works_list').show();
    } );
});
</script>
{% endblock %}